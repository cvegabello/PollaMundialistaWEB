<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mundial 2026 - Polla Web</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<canvas id="particles"></canvas>

<div id="login-overlay">
    <div class="login-box">
        <img src="assets/img/WC26_Logo.avif" alt="Mundial 2026 Logo" class="login-logo-img">
        
        <input type="text" id="username" class="login-input" placeholder="Nombre de Jugador">
        <div style="position: relative; width: 100%; margin-bottom: 20px;">
            <input type="password" id="password" class="login-input" placeholder="Clave Admin (Opcional)" style="margin-bottom: 0; padding-right: 40px;">
            <span id="eye-icon" onclick="togglePass()" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 1.2rem; filter: grayscale(100%);" title="Ver contrase√±a">
                üëÅÔ∏è
            </span>
        </div>
        <button class="btn-enter" onclick="handleLogin()">ENTRAR</button>
        
        

        <div id="app-footer" style="text-align: center; margin-top: 25px; border-top: 1px solid #333; padding-top: 10px;">
            <div class="login-credits">Dise√±ado y desarrollado por Carlos Vega</div>
             <small style="color: #666; font-size: 0.7rem;">Polla Mundial 2026 &copy; VegaSoft</small> <br>
             <span id="app-version-badge" style="background: #333; color: #ffaa00; padding: 2px 8px; border-radius: 10px; font-weight: bold; font-size: 0.7rem; margin-top: 5px; display: inline-block;">
                Cargando versi√≥n...
             </span>
        </div>
    </div>


    </div>
</div>

<div class="container" id="app">
    <header>
        <h1>COPA MUNDIAL 2026</h1>
        
        <div class="status-container" id="user-status-bar">
            <div class="user-info">
                <div class="user-name" id="display-username">USUARIO</div>
                <div class="user-progress" id="display-progress">Fases: 0/6</div>
            </div>
            <div style="text-align:center;">
                <span id="display-status" class="status-badge bg-draft">BORRADOR</span>
            </div>
            <div>
                <div style="font-size:0.7rem; color:#888; font-weight:700; text-align:center;">PUNTOS</div>
                <div class="points-value" id="total-points">--</div>
            </div>
        </div>

        <div id="admin-status-bar" style="display:none; margin-top:20px; padding:10px 20px; background:rgba(138, 43, 226, 0.2); border:1px solid #8a2be2; border-radius:30px; color:#d8b4fe; font-weight:900; font-size:0.8rem;">
            PANEL DE ADMINISTRADOR
        </div>

        <div class="toolbar">
            <!-- <button class="tool-btn" onclick="smartSave()" title="Guardar">üíæ <span class="tool-text">Guardar</span></button> -->
            
            <button class="tool-btn" onclick="showReport()" title="Ranking">üèÜ <span class="tool-text">Ranking</span></button>
            
            <button class="tool-btn" onclick="showThirdsTable()" title="Terceros">ü•â <span class="tool-text">3ros</span></button>
            
            <!-- <button class="tool-btn" id="btn-refresh" onclick="refreshData()" title="Actualizar">üîÑ <span class="tool-text">Recargar</span></button> -->
            
            <button class="tool-btn logout" onclick="logout()" title="Salir">üö™ <span class="tool-text">Salir</span></button>
        </div>

    </header>

    <div id="fan-dashboard" class="dashboard-container hidden">
        
        <div class="control-card user-card">
            <div class="card-header">
                <span class="card-icon">üë§</span> 
                <span class="card-title">MIS PRON√ìSTICOS</span>
            </div>
            <div class="card-buttons">
                <button id="btn-user-groups" class="dash-btn active" onclick="loadView('user', 'groups')">Fase Grupos</button>
                <button id="btn-user-final" class="dash-btn" onclick="loadView('user', 'final')">Fase Final</button>
            </div>
        </div>

        <div class="control-card official-card">
            <div class="card-header">
                <span class="card-icon">üèÜ</span> 
                <span class="card-title">RESULTADOS FIFA</span>
            </div>
            <div class="card-buttons">
                <button id="btn-off-groups" class="dash-btn btn-gold" onclick="loadView('official', 'groups')">Ver Grupos</button>
                <button id="btn-off-final" class="dash-btn btn-gold" onclick="loadView('official', 'final')">Ver Finales</button>
            </div>
        </div>
    </div>

    <div id="admin-dashboard" class="dashboard-container hidden">
        <div class="control-card admin-card">
            <div class="card-header">
                <span class="card-icon">‚ö°</span> 
                <span class="card-title">PANEL DE CONTROL</span>
            </div>
            <div class="card-buttons admin-buttons-row">
                <button id="btn-admin-groups" class="dash-btn btn-admin" onclick="loadView('admin', 'groups')">
                    üìù Grupos
                </button>
                <button id="btn-admin-final" class="dash-btn btn-admin" onclick="loadView('admin', 'final')">
                    üèÜ Finales
                </button>
            </div>
            <div style="margin-top:10px; width:100%">
                <button id="btn-admin-settings" class="dash-btn btn-settings" onclick="loadView('admin', 'settings')">
                    ‚öôÔ∏è Configuraci√≥n
                </button>
            </div>
        </div>
    </div>

    <h2 id="view-title" class="dynamic-title">Cargando...</h2>

    <div id="tab-groups" class="section active">
        <div id="submit-groups-area" class="hidden">
            <span id="groups-msg" style="display:block; margin-bottom:10px; font-weight:bold;">Fase en Borrador.</span>
            <button id="btn-submit-groups" class="btn-big-submit" onclick="submitPhase('groups')">ENVIAR OFICIALMENTE</button>
        </div>
        <div id="groups-container" class="groups-grid"></div>
    </div>

    <div id="tab-real" class="section">
        <div style="text-align:center; margin-bottom:10px; color:var(--neon-green); text-transform:uppercase; letter-spacing:2px; font-weight:900;">
            Fase de Grupos - Oficial
        </div>
        <div id="real-container" class="groups-grid" style="margin-bottom: 40px;"></div>

        <div style="text-align:center; margin-bottom:10px; margin-top:40px; color:var(--neon-green); text-transform:uppercase; letter-spacing:2px; font-weight:900; border-top: 1px solid #333; padding-top: 20px;">
            Fase Final - Oficial
        </div>
        <div id="real-bracket-container" class="bracket-container"></div>
    </div>

    <div id="tab-bracket" class="section">
        <div id="bracket-container" class="bracket-container"></div>
    </div>

    <div id="tab-settings" class="section">
        <div id="admin-panel" class="admin-panel card-modern">
            <h4 style="text-align:center; color:var(--neon-blue);">‚öôÔ∏è CONFIGURACI√ìN & REGLAS</h4>
            
            <div style="margin-bottom: 20px; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:20px;">
                <label style="display:block; color:var(--neon-gold); margin-bottom:10px; font-weight:bold; letter-spacing:1px;">‚öΩ PUNTOS POR PARTIDO</label>
                <div class="rules-grid">
                    <div><label>Exacto</label><input type="number" id="rule-exact" onchange="saveAdminData()"></div>
                    <div><label>Diferencia</label><input type="number" id="rule-diff" onchange="saveAdminData()"></div>
                    <div><label>Ganador</label><input type="number" id="rule-winner" onchange="saveAdminData()"></div>
                </div>

                <label style="display:block; color:var(--neon-green); margin-top:20px; margin-bottom:10px; font-weight:bold; letter-spacing:1px;">üèÜ BONUS GRUPOS (CLASIFICADOS)</label>
                <div class="rules-grid">
                    <div><label>1¬∞ y 2¬∞ Exacto</label><input type="number" id="rule-group-exact" placeholder="Ej: 10" onchange="saveAdminData()"></div>
                    <div><label>Los 2 (Desorden)</label><input type="number" id="rule-group-mix" placeholder="Ej: 5" onchange="saveAdminData()"></div>
                    <div><label>Solo 1 Equipo</label><input type="number" id="rule-group-one" placeholder="Ej: 2" onchange="saveAdminData()"></div>
                </div>
            </div>

            <div>
                <label style="display:block; color:var(--neon-pink); margin-bottom:10px;">Habilitar Fases (Check para abrir)</label>
                <div class="phase-grid">
                    <label class="phase-item"><input type="checkbox" id="check-groups" onchange="saveAdminData()"> Grupos</label>
                    <label class="phase-item"><input type="checkbox" id="check-r32" onchange="saveAdminData()"> 16avos</label>
                    <label class="phase-item"><input type="checkbox" id="check-r16" onchange="saveAdminData()"> 8vos</label>
                    <label class="phase-item"><input type="checkbox" id="check-qf" onchange="saveAdminData()"> Cuartos</label>
                    <label class="phase-item"><input type="checkbox" id="check-sf" onchange="saveAdminData()"> Semis</label>
                    <label class="phase-item"><input type="checkbox" id="check-f" onchange="saveAdminData()"> Final</label>
                </div>
            </div>
            
            <br>
            <button class="btn-enter" style="width:auto; margin:0 auto; display:block;" onclick="openUserManagement()">üë• Gestionar Usuarios</button>
        </div>
    </div>
</div>

<div class="fab-container" style="display: none !important;">
    <button id="btn-thirds" class="fab" style="background:var(--neon-pink); color:white; margin-bottom:10px;" onclick="showThirdsTable()">ü•â 3ros</button>
    <button id="btn-report" class="fab fab-report" onclick="showReport()">üèÜ Ranking</button>
    <button id="btn-refresh" class="fab fab-refresh" onclick="refreshData()">üîÑ Recargar</button>
    <button id="btn-save-draft" class="fab fab-save" onclick="saveUser(false)">üíæ Guardar</button>
    <button id="btn-save-admin" class="fab fab-admin" onclick="saveAdminData(true)">üíæ Guardar Todo</button>
</div>

<div id="modal-overlay">
    <div class="modal-card">
        <button class="close-btn" onclick="document.getElementById('modal-overlay').style.display='none'">&times;</button>
        <h3 id="modal-title" style="color:var(--neon-blue); margin-top:0;">INFO</h3>
        <div id="report-content"></div>
    </div>
</div>

<div id="modal-thirds-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; justify-content:center; align-items:center;">
    <div class="modal-card" style="width: 800px; max-width: 95%; max-height: 95vh; height: auto; padding: 20px;">
        <button class="close-btn" onclick="document.getElementById('modal-thirds-overlay').style.display='none'">&times;</button>
        <h3 style="color:var(--neon-pink); margin-top:0; text-align:center; text-transform:uppercase;">Tabla de Mejores Terceros</h3>
        <p style="text-align:center; color:#aaa; font-size:0.8rem; margin-bottom:15px;">Clasifican los 8 primeros (Fondo Verde)</p>
        
        <div style="overflow-x:auto; overflow-y:visible;">
            <table class="ranking-table" id="thirds-table-content" style="font-size:0.85rem;">
                <thead>
                    <tr style="background:#222; color:var(--neon-blue);">
                        <th>POS</th>
                        <th>GRP</th> <th>SELECCI√ìN</th>
                        <th title="Puntos">PTS</th>
                        <th title="Jugados">J</th>
                        <th title="Ganados">G</th>
                        <th title="Empatados">E</th>
                        <th title="Perdidos">P</th>
                        <th title="Goles Favor">GF</th>
                        <th title="Goles Contra">GC</th>
                        <th title="Diferencia">DG</th>
                    </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>
    </div>
</div>


<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>


<script src="js/data.js"></script>
<script src="js/app.js"></script>

</body>
</html>